Prospectus.extra_dep('file', 'prospectus_travis')
Prospectus.extra_dep('file', 'prospectus_terraform')

item do
  noop

  extend ProspectusTravis::Build.new('akerl/aws-account')
  extend ProspectusTerraform::Providers.new

  deps do
    [
      ['modules/madlibrarian', 'akerl/madlibrarian-lambda'],
      ['modules/hookshot', 'akerl/hookshot'],
      ['akerl/go-hello-linodians', 'akerl/go-hello-linodians'],
      ['modules/github-auth', 'akerl/github-auth-lambda']
    ].each do |mpath, mrepo|
      item do
        name mpath

        expected do
          github_release
          repo mrepo
        end

        actual do
          static
          set File.read("#{mpath}/version").chomp
        end
      end
    end

    item do
      name 'terraform'

      expected do
        github_release
        repo 'hashicorp/terraform'
        regex /^v?([\d.]+)$/
        filter /^v?([\d.]+)$/
      end

      actual do
        grep
        file '.travis.yml'
        regex /^\s+- TERRAFORM_VERSION=([\d.]+)$/
      end
    end
  end
end
